<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>換錢工具</title>
</head>
<link rel="stylesheet" href="css/jquery-editable-select.css">
<script type="text/javascript" src="js/jquery-3.3.1.min.js"></script>
<script type="text/javascript" src="js/jquery-editable-select.js"></script>
<!--  <script type="text/javascript" src="picker-master/dist/picker.min.js"></script> -->
<script type="text/javascript" src="js/picker.js"></script>

<link rel="stylesheet" href="css/test1.css">
<script src="js/fabric.min.js"></script>


<style>
    * {
        margin: 0;
    }

    html,
    body {
        height: 100%;
        width: 100%;
    }

    .es-list {
        max-height: 120px !important;
        text-align: center;
    }

    .es-input {
        max-width: 8vw;
        text-align: center;
    }

    .choose_money {
        display: flex;
        height: 20%;
        width: 100%;
        border: 1px solid #cccccc;
        position: fixed;
        bottom: 0;
    }

   
    .project-img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        object-position: center;
        display: block;
        user-select: none;
        pointer-events: none;
        border-radius: 50%;
        text-align: center;
        transition: .5s;
    }

    .flex_jsutinfity {
        display: flex;
        flex-direction: column;
        height: 65%;
        flex-wrap: wrap;
    }

    .project {
        width: 80px;
        flex-shrink: 0;
        margin: 0 10px;
        height: 80px;
        border-radius: 50%;
        user-select: none;
        cursor: pointer;
        left: 0;
        top: 100px;
        left: 100px;
        transition: .4s;
        position: relative;
        z-index: 1;
        transform-origin: center;
        margin-top: -40px;
    }

    .project-name {
        position: absolute;
        width: 140px;
        text-align: center;
        left: 50%;
        top: 100%;
        font-size: 14px;
        transition: .3s;
        font-weight: 700;
        color: rgba(0, 0, 0, 1);
        pointer-events: none;
        transform: translateX(-50%) translateY(0) scale(.8);

    }



    .input_1 {
        height: 30px;
    }

    .project.is-selected {
        z-index: 2;
    }

    .project.is-selected>.project-img {
        box-shadow: 0 0 0 6px red;
    }

    .showcase.is-dragging .project {
        pointer-events: none;
        transition: none;
    }

    .showcase.is-dragging .drop {
        border-color: red;
        color: red;
    }

    .wrong {
        border: 3px solid red;

    }

    .drop {
        position: fixed;
        top: 0%;
        right: 0%;
        width: 150px;
        height: 300px;
        border: 3px solid #ddd;
        color: darken(#ddd, 15%);
        /* border-radius: 50%; */
        transition: .5s;
        text-align: center;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 15px;
        font-weight: 500;
        padding: 10px;
        user-select: none;
    }

    .color_change {
        background: #555555;
        color: #cccccc;
    }

    .color_change:hover {
        background: #222222;
        color: #cccccc;
    }

    .start_btn_change_money {
        position: fixed;
        top: 330px;
        right: 0%;
        width: 150px;
        height: 20px;
        border: 3px solid #ddd;
        color: darken(#ddd, 15%);
        /* border-radius: 50%; */
        transition: .5s;
        text-align: center;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 15px;
        font-weight: 500;
        padding: 10px;
        user-select: none;
    }

    .drop.is-ready {
        color: transparent;
        background-color: red;
    }



    .project.is-expanded>.project-img {
        border-radius: 0;
    }


    .showcase {
        height: 100vh;
        overflow: hidden;
        justify-content: left;
        display: flex;
    }

    .showcase.is-preview>.project {
        pointer-events: none;
        opacity: 0;
        width: 0;
        height: 0;
        margin: 0;
    }

    .showcase.is-preview>.project.is-expanded {
        opacity: 1;
        transition: .7s;
        z-index: 2;
        width: 100%;
        height: 100%;
        transform: none !important;
        z-index: 2;
    }
    img{
        width: 20px;
    }
    canvas {
            border: 1px solid #000;
        }
</style>

<body>
    <div class="choose_money">


        <div class="money_1000">
            <img id="defaultImg" src="https://www.pakutaso.com/shared/img/thumb/neko1869IMG_9074_TP_V.jpg" alt="" draggable>

            <select id="editable-select">
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5</option>
                <option value="6">6</option>
                <option value="7">7</option>
                <option value="8">8</option>
                <option value="9">9</option>
                <option value="10">10</option>
            </select>
        </div>

        <div class="money_500">
            <select id="editable-select_2">
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5</option>
                <option value="6">6</option>
                <option value="7">7</option>
                <option value="8">8</option>
                <option value="9">9</option>
                <option value="10">10</option>
            </select>
        </div>
        <div class="money_100">
            <select id="editable-select_3">
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5</option>
                <option value="6">6</option>
                <option value="7">7</option>
                <option value="8">8</option>
                <option value="9">9</option>
                <option value="10">10</option>
            </select>
        </div>
        <div class="money_50">
            <select id="editable-select_4">
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5</option>
                <option value="6">6</option>
                <option value="7">7</option>
                <option value="8">8</option>
                <option value="9">9</option>
                <option value="10">10</option>
            </select>
        </div>
        <div class="money_10">

            <select id="editable-select_5">
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5</option>
                <option value="6">6</option>
                <option value="7">7</option>
                <option value="8">8</option>
                <option value="9">9</option>
                <option value="10">10</option>
            </select>
        </div>

        <div class="money_5">
            <select id="editable-select_6">
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5</option>
                <option value="6">6</option>
                <option value="7">7</option>
                <option value="8">8</option>
                <option value="9">9</option>
                <option value="10">10</option>
            </select>
        </div>
        <div class="money_1">
            <select id="editable-select_7">
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5</option>
                <option value="6">6</option>
                <option value="7">7</option>
                <option value="8">8</option>
                <option value="9">9</option>
                <option value="10">10</option>
            </select>
        </div>
        <input type="text" class="input_1 animated bounceInUp " onkeyup="return ValidateNumber($(this),value) ">

        <div class="text_output ">



        </div>
        <button class="delet_all ">

            刪除全部

        </button>

    </div>

    <div class="pick_what_you_want">

        <div id="name">點我選擇</div>


    </div>
    <!-- delay-2s -->






    <div class="showcase">
        <canvas id="canvas"></canvas>

        <!-- <div class="flex_jsutinfity append_area_1">

        </div>


        <div class="flex_jsutinfity append_area_2">

        </div>


        <div class="flex_jsutinfity append_area_3">


        </div>

        <div class="flex_jsutinfity append_area_4">



        </div>

        <div class="flex_jsutinfity append_area_5">

        </div>

        <div class="flex_jsutinfity append_area_6">



        </div>


        <div class="flex_jsutinfity append_area_7">

        </div> -->





        <div class="drop">換錢</div>
        <div class="start_btn_change_money color_change">請將想換零之物件置於上方</div>
    </div>

































    <script>



        const canvas = new fabric.Canvas('canvas', {
            width: 1000,
            height: 500
        })





        fabric.Object.prototype.setControlsVisibility({
            bl: true, // 左下
            br: true, // 右下
            mb: false, // 下中
            ml: false, // 中左
            mr: false, // 中右
            mt: false, // 上中
            tl: true, // 上左
            tr: true, // 上右
            mtr: false // 旋轉控制鍵
        })



        const imageUploader =document.querySelector('#imageUploader')
        const file = document.querySelector('#file')
        const imgset = document.querySelector('#imgset')
        const defaultImg =  document.querySelector('#defaultImg')
        let movingImage
        let imgDragOffset = {
            offsetX: 0,
            offsetY: 0
        }
        function uploadFile(e) {
            file.click()
        }

        function saveImg(e) {
            if (e.target.tagName.toLowerCase() === 'img') {
                imgDragOffset.offsetX = e.clientX - e.target.offsetLeft
                imgDragOffset.offsetY = e.clientY - e.target.offsetTop
                movingImage = e.target
            }
        }

        function handleFile() {
            const fileReader = new FileReader();
            fileReader.readAsDataURL(this.files[0])
            fileReader.onload = (e) => {
                // 圖片 base64
                const dataURL = e.target.result
                const img = document.createElement('img')
                img.draggable = true
                img.src = dataURL
                imgset.appendChild(img)
            }
        }

        function dropImg(e) {
            const { offsetX, offsetY } = e.e
            const image = new fabric.Image(movingImage, {
                width: movingImage.naturalWidth,
                height: movingImage.naturalHeight,
                scaleX: 100 / movingImage.naturalWidth,
                scaleY: 100 / movingImage.naturalHeight,
                top: offsetY - imgDragOffset.offsetY,
                left: offsetX - imgDragOffset.offsetX
            })
            canvas.add(image)
        }

        // imageUploader.addEventListener('click', uploadFile, true)
        canvas.on('drop', dropImg)
        
        // defaultImg.addEventListener('mousedown', saveImg)
        // imgset.addEventListener('mousedown', saveImg)
        // defaultImg.addEventListener('mousedown', saveImg)
        // imgset.addEventListener('mousedown', saveImg)
        $("#defaultImg").mousedown(function () { saveImg() })
        $("#imgset").mousedown(function () { saveImg() })


        var output_thousand_number = 0
        var output_five_hundred_number = 0
        var output_one_hundred_number = 0
        var output_fifty_number = 0
        var output_ten_number = 0
        var output_five_number = 0
        var output_one_number = 0









        var all_editable = $('#editable-select,editable-select_2,editable-select_3,editable-select_4,editable-select_5,editable-select_6,editable-select_7')
        $('#editable-select').editableSelect({ effects: 'fade' });
        $('#editable-select_2').editableSelect({ effects: 'fade' });
        $('#editable-select_3').editableSelect({ effects: 'fade' });
        $('#editable-select_4').editableSelect({ effects: 'fade' });
        $('#editable-select_5').editableSelect({ effects: 'fade' });
        $('#editable-select_6').editableSelect({ effects: 'fade' });
        $('#editable-select_7').editableSelect({ effects: 'fade' });
        var project_1 = `  <div class="project">
                <img class="project-img color_1" />
                <span class="project-name">1</span>
            </div>`
        var project_2 = `  <div class="project">
                <img class="project-img color_2" />
                <span class="project-name">5</span>
            </div>`
        var project_3 = `  <div class="project">
                <img class="project-img color_3" />
                <span class="project-name">10</span>
            </div>`
        var project_4 = `  <div class="project">
                <img class="project-img color_4" />
                <span class="project-name">50</span>
            </div>`
        var project_5 = `  <div class="project">
                <img class="project-img color_5" />
                <span class="project-name">100</span>
            </div>`
        var project_6 = `  <div class="project">
                <img class="project-img color_6" />
                <span class="project-name">500</span>
            </div>`
        var project_7 = `  <div class="project">
                <img class="project-img color_7" />
                <span class="project-name">1000</span>
            </div>`
        //

        //create 錢幣

        $("#editable-select,#editable-select_2,#editable-select_3,#editable-select_4,#editable-select_5,#editable-select_6,#editable-select_7 ").blur(function () {
            if ($(this).val() > 10) {
                $(this).val(10)

                console.log("超過數字")
            }
            output_one_number = $("#editable-select").val()
            output_five_number = $("#editable-select_2").val()
            output_ten_number = $("#editable-select_3").val()
            output_fifty_number = $("#editable-select_4").val()
            output_one_hundred_number = $("#editable-select_5").val()
            output_five_hundred_number = $("#editable-select_6").val()
            output_thousand_number = $("#editable-select_7").val()
            append_dollars(output_one_number, output_five_number, output_ten_number, output_fifty_number, output_one_hundred_number, output_five_hundred_number, output_thousand_number)
            $(this).val("")

        })


        function append_dollars(output_one_number, output_five_number, output_ten_number, output_fifty_number, output_one_hundred_number, output_five_hundred_number, output_thousand_number) {
            for (i = 0; i < output_one_number; i++) {
                $(".append_area_1").append(project_1)
            }
            for (i = 0; i < output_five_number; i++) {
                $(".append_area_2").append(project_2)
            }
            for (i = 0; i < output_ten_number; i++) {
                $(".append_area_3").append(project_3)
            }
            for (i = 0; i < output_fifty_number; i++) {
                $(".append_area_4").append(project_4)
            }
            for (i = 0; i < output_one_hundred_number; i++) {
                $(".append_area_5").append(project_5)
            }
            for (i = 0; i < output_five_hundred_number; i++) {
                $(".append_area_6").append(project_6)
            }
            for (i = 0; i < output_thousand_number; i++) {
                $(".append_area_7").append(project_7)
            }
        }
        $(".delet_all").click(function () {
            $(".flex_jsutinfity").empty()
        })
        //運算最大數字

        // $(".input_1").change(function(){
        //    $(".input_1").val($(".input_1").val().replace(/[/u0391-/uFFE5]/gi,''))
        // })

        //KEY數字 輸出所KEY數字有幾張
        var one_thousand_number = 0
        var five_hundred_number = 0
        var one_hundred_number = 0
        var fifty_number = 0
        var ten_number = 0
        var five_number = 0
        var one_number = 0

        //暫時存放金錢
        var temporary_storage = 0


        $(".input_1").change(function () {
            $(".flex_jsutinfity").empty()


            if ($(".input_1").val() > 10999) {
                $(".input_1").val(10999)
            }

            //一千
            one_thousand_number = Math.floor($(".input_1").val() / 1000)
            temporary_storage = $(".input_1").val() % 1000

            //五百
            five_hundred_number = Math.floor(temporary_storage / 500)
            temporary_storage = temporary_storage % 500

            //一百
            one_hundred_number = Math.floor(temporary_storage / 100)
            temporary_storage = temporary_storage % 100

            //五十
            fifty_number = Math.floor(temporary_storage / 50)
            temporary_storage = temporary_storage % 50

            //十
            ten_number = Math.floor(temporary_storage / 10)
            temporary_storage = temporary_storage % 10

            //十
            five_number = Math.floor(temporary_storage / 5)
            temporary_storage = temporary_storage % 5

            one_number = Math.floor(temporary_storage / 1)
            temporary_storage = temporary_storage % 1

            $(".text_output").html(`一千=${one_thousand_number} </br> 五百=${five_hundred_number} </br>  一百=${one_hundred_number} </br> 五十=${fifty_number} </br>  十=${ten_number} </br> 五=${five_number} </br>  一=${one_number} `)
            append_dollars(one_number, five_number, ten_number, fifty_number, one_hundred_number, five_hundred_number, one_thousand_number)


        })




        function ValidateNumber(e, pnumber) {
            if (!/^\d+$/.test(pnumber)) {
                $(e).val(/^\d+/.exec($(e).val()));
            }
            return false;
        }
























        var input_money = 0
        var cal_money = 0
        var output_money = 0










        // var projects = document.querySelectorAll(".project");
        // var drop = document.querySelector(".drop");
        // var showcase = document.querySelector(".showcase");
        // var start_btn_change_money = document.querySelector(".start_btn_change_money")
        // var start,
        //     offsetY,
        //     offsetX,
        //     targetRect,
        //     //
        //     target,
        //     dropped = false,
        //     expanded = false;

        // var stopped = function stopped() {
        //     start = false;

        //     if (target) {
        //         showcase.classList.remove("is-dragging");
        //         target.classList.remove("is-selected");
        //         drop.classList.remove("is-active");
        //         drop.classList.remove("is-ready");
        //     }

        //     if (dropped) {
        //         // showcase.classList.add("is-preview");
        //         target.classList.add("is-expanded");
        //         drop.classList.add("is-dropped");
        //         $(".start_btn_change_money").text("點此開始換錢")
        //         expanded = true;
        //         input_money = $('.is-expanded span').text()







        //     } else {
        //         drop.classList.remove("is-dropped");
        //         // showcase.classList.remove("is-preview");
        //         target.classList.remove("is-expanded");
        //         $(".start_btn_change_money").text("請將想換零之物件置於上方")
        //         expanded = false;
        //     }
        // };

        // var started = function started(e, type) {
        //     start = true;
        //     target = e.target;

        //     if (type === "touch") {
        //         console.log(e.touches[0]);
        //         offsetY = target.offsetWidth / 2 + target.offsetTop;
        //         offsetX = target.offsetWidth / 2 + target.offsetLeft;
        //     } else {
        //         offsetY = e.offsetY + target.offsetTop;
        //         offsetX = e.offsetX + target.offsetLeft;
        //     }

        //     targetRect = target.getBoundingClientRect();
        //     target.classList.add("is-selected");
        //     showcase.classList.add("is-dragging");
        // };




        // $('.flex_jsutinfity').on('mousedown', ".project", function (e) {
        //     started(e, "mouse");

        // });

        // $('.flex_jsutinfity').on('touchstart', ".project", function (e) {
        //     started(e, "mouse");

        // });

        // // project.addEventListener("mousedown", function (e) {
        // // });
        // // project.addEventListener("touchstart", function (e) {
        // //     started(e, "touch");
        // // });





        // var docUp = function docUp() {
        //     if (!expanded && target) {
        //         stopped();
        //     }
        // };

        // document.addEventListener("mouseup", function () {
        //     docUp();
        // });
        // document.addEventListener("touchend", function () {
        //     docUp();
        // });

        // var docMove = function docMove(e, type) {
        //     var clientX = 0,
        //         clientY = 0;

        //     if (type === "touch") {
        //         clientX = e.touches[0].clientX;
        //         clientY = e.touches[0].clientY;
        //     } else {
        //         clientX = e.clientX;
        //         clientY = e.clientY;

        //     }
          
        //     if (clientY > drop.offsetTop && clientY < drop.offsetTop + drop.offsetHeight && clientX > drop.offsetLeft && clientX < drop.offsetLeft + drop.offsetWidth && start && !expanded) {
        //         drop.classList.add("is-ready");
        //         dropped = true;
           

        //     } else {
        //         drop.classList.remove("is-ready");
        //         dropped = false;
        //     }

        //     if (start && !expanded) {
        //         target.style.transform = "translateY(".concat(clientY - offsetY, "px) translateX(").concat(clientX - offsetX, "px)");
        //     }
        // };

        // document.addEventListener("mousemove", function (e) {
        //     docMove(e, "mouse");
        // });
        // document.addEventListener("touchmove", function (e) {
        //     docMove(e, "touch");
        // });
        // start_btn_change_money.addEventListener("click", function () {
        //     if (expanded) {
        //         dropped = false;
        //         target.style.transform = "none";


        //         if ($('#name').text() == "點我選擇") {
        //             $('.pick_what_you_want').addClass("wrong")
        //             $('#name').text('請先選擇想兌換幣額')


        //         } else {
        //             $('.pick_what_you_want').removeClass("wrong")

        //             cal_money = $('#name').text()
        //             output_money = input_money / cal_money


        //             $('#name').text('點我選擇')
        //         }


        //         stopped();




        //     }
        // });





        var nameEl = document.getElementById('name');
        var pick_dollars = document.querySelector('.pick_what_you_want');
        var data1 = [

            {
                text: '1000',
                value: 1
            },
            {
                text: '500',
                value: 2
            },
            {
                text: '100',
                value: 3
            },
            {
                text: '50',
                value: 4
            },
            {
                text: '10',
                value: 5
            },
            {
                text: '5',
                value: 6
            },
            {
                text: '1',
                value: 7
            },
            

        ];


        var picker = new Picker({
            data: [data1],
            selectedIndex: [2],
            title: ''
        });

        picker.on('picker.select', function (selectedVal, selectedIndex) {
            nameEl.innerHTML = data1[selectedIndex[0]].text;
        })

        picker.on('picker.change', function (index, selectedIndex) {
            console.log(index);
            console.log(selectedIndex);
        });

        picker.on('picker.valuechange', function (selectedVal, selectedIndex) {
            console.log(selectedVal);
            console.log(selectedIndex);
        });

        pick_dollars.addEventListener('click', function () {
            picker.show();
        });

        $(".wheel-item").addClass("kkkkk")
        $(".kkkkk:nth-child(1)").html(`<img src="img/Chrysanthemum.jpg" alt=""><div>1000元</div>`)
        $(".kkkkk:nth-child(2)").html(`<img src="img/Desert.jpg" alt=""><div>500元</div>`)
        $(".kkkkk:nth-child(3)").html(`<img src="img/Hydrangeas.jpg" alt=""><div>100元</div>`)
        $(".kkkkk:nth-child(4)").html(`<img src="01.png" alt=""><div>50元</div>`)
        $(".kkkkk:nth-child(5)").html(`<img src="img/Koala.jpg" alt=""><div>10元</div>`)
        $(".kkkkk:nth-child(6)").html(`<img src="img/Lighthouse.jpg" alt=""><div>5元</div>`)
        $(".kkkkk:nth-child(7)").html(`<img src="img/Jellyfish.jpg" alt=""><div>1元</div>`)






















    </script>

</body>

</html>